syms t1 t2 t3 t4 t5 t6 a1 a2 a3 a4 a b c x y z phi
k = [a;b;c]; phi = sqrt(a^2+b^2+c^2);
if phi==0
    k = [0;0;0];
else
    k = k/phi;
end
k = [0;0;0]; phi = 0;
R0 = cos(phi)*eye(3)+(1-cos(phi))*(k*k.')+sin(phi)*wave(k);
T0 = [R0(1,1),R0(1,2),R0(1,3),x;
    R0(2,1),R0(2,2),R0(2,3),y;
    R0(3,1),R0(3,2),R0(3,3),z;
    0,0,0,1];
T1 = [cos(t1),-sin(t1),0,20;
    sin(t1),cos(t1),0,0;
    0,0,1,0;
    0,0,0,1]; 
T2 = [cos(t2),-sin(t2),0,a1;
    0,0,1,0;
    -sin(t2),-cos(t2),0,0;
    0,0,0,1];
T3 = [cos(t3),-sin(t3),0,a2;
    sin(t3),cos(t3),0,0;
    0,0,1,0;
    0,0,0,1];
T4 = [cos(t4),-sin(t4),0,a3;
    0,0,1,0;
    -sin(t4),-cos(t4),0,0;
    0,0,0,1];
T5 = [cos(t5),-sin(t5),0,0;
    0,0,-1,0;
    sin(t5),cos(t5),0,0;
    0,0,0,1];
T6 = [cos(t6),-sin(t6),0,0;
    0,0,1,0;
    -sin(t6),-cos(t6),0,0;
    0,0,0,1];
T = simplify(T1*T2*T3);
TT = simplify(T4*T5*T6);
TTT = simplify(T0*T*TT);
P4 = [a4;0;0;1];
P0 = simplify(TTT*P4);
Rnq = [TTT(1,1),TTT(1,2),TTT(1,3);
    TTT(2,1),TTT(2,2),TTT(2,3);
    TTT(3,1),TTT(3,2),TTT(3,3)];
Pnq = [TTT(1,4);TTT(2,4);TTT(3,4)];
Jv1 = diff(Pnq,t1);
RnqP1 = diff(Rnq,t1);
Jw1x = simplify(RnqP1*Rnq.');
Jw1 = [-Jw1x(2,3);Jw1x(1,3);Jw1x(2,1)];
J1 = [Jv1;Jw1];
Jv2 = diff(Pnq,t2);
RnqP2 = diff(Rnq,t2);
Jw2x = simplify(RnqP2*Rnq.');
Jw2 = [-Jw2x(2,3);Jw2x(1,3);Jw2x(2,1)];
J2 = [Jv2;Jw2];
Jv3 = diff(Pnq,t3);
RnqP3 = diff(Rnq,t3);
Jw3x = simplify(RnqP3*Rnq.');
Jw3 = [-Jw3x(2,3);Jw3x(1,3);Jw3x(2,1)];
J3 = [Jv3;Jw3];
Jv4 = diff(Pnq,t4);
RnqP4 = diff(Rnq,t4);
Jw4x = simplify(RnqP4*Rnq.');
Jw4 = [-Jw4x(2,3);Jw4x(1,3);Jw4x(2,1)];
J4 = [Jv4;Jw4];
Jv5 = diff(Pnq,t5);
RnqP5 = diff(Rnq,t5);
Jw5x = simplify(RnqP5*Rnq.');
Jw5 = [-Jw5x(2,3);Jw5x(1,3);Jw5x(2,1)];
J5 = [Jv5;Jw5];
Jv6 = diff(Pnq,t6);
RnqP6 = diff(Rnq,t6);
Jw6x = simplify(RnqP6*Rnq.');
Jw6 = [-Jw6x(2,3);Jw6x(1,3);Jw6x(2,1)];
J6 = [Jv6;Jw6];
Jm = [J1,J2,J3,J4,J5,J6];

